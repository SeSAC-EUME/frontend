# 백엔드-프론트엔드 연동 최종 계획서 v3
<!-- Encoding: UTF-8 (no BOM), Line Ending: CRLF -->

> **최종 문서**: 001-003 검토 및 Claude Code + Codex 토론 결과를 반영한 구현용 최종 계획서
> **작성일**: 2025-11-28
> **대상**: Claude Code 구현 에이전트

---

## 1. 개요

### 1.1 프로젝트 정보
- **프론트엔드**: React 19 + Vite (`http://localhost:3000`)
- **백엔드**: Spring Boot (`http://localhost:8080`)
- **Swagger**: `http://localhost:8080/swagger-ui/index.html`

### 1.2 핵심 합의 사항 (Round 1-4 결과)
| 항목 | 결정 |
|------|------|
| 인증 방식 | **HttpOnly 쿠키** + `withCredentials: true` |
| 토큰 저장 | 쿠키 (백엔드 관리), localStorage는 사용자 정보 캐시만 |
| Axios 인터셉터 | 기존 `response.data` 유지 + 상태코드 필요 시 `axiosRaw` 사용 |
| API 경로 | 모든 엔드포인트에 `/api/` 프리픽스 필수 |
| 인코딩 | UTF-8 (BOM 없음), CRLF |

---

## 2. 구현 작업 목록

### 2.1 작업 요약

| # | 작업 | 대상 파일 | 우선순위 |
|---|------|----------|---------|
| 1 | API 엔드포인트 수정 | `src/shared/api/config.js` | **긴급** |
| 2 | Axios 인스턴스 수정 | `src/shared/api/axios.js` | **긴급** |
| 3 | axiosRaw 인스턴스 생성 | `src/shared/api/axiosRaw.js` (신규) | **긴급** |
| 4 | 관리자 로그인 수정 | `src/admin/pages/Login.jsx` | **긴급** |
| 5 | 온보딩 흐름 수정 | `src/user/pages/Onboarding4.jsx` | **긴급** |
| 6 | OAuth2 리다이렉트 수정 | `src/user/pages/OAuth2Redirect.jsx` | 높음 |
| 7 | 테마 매핑 유틸리티 생성 | `src/shared/utils/themeMapper.js` (신규) | 높음 |
| 8 | localStorage 키 상수 정의 | `src/shared/constants/storage.js` (신규) | 높음 |
| 9 | 사용자 홈 채팅 연동 | `src/user/pages/Home.jsx` | 중간 |
| 10 | 사용자 설정 페이지 연동 | `src/user/pages/Settings.jsx` | 중간 |

---

## 3. 상세 구현 가이드

### 3.1 [긴급] API 엔드포인트 수정

**파일**: `src/shared/api/config.js`

**변경 전**:
```javascript
export const API_ENDPOINTS = {
  ADMIN: {
    LOGIN: `${JAVA_URL}admin/login`,
    REGISTER: `${JAVA_URL}admin/register`,
    CHANGE_PASSWORD: `${JAVA_URL}admin/change-password`,
  },
  USER: {
    LOGOUT: `${JAVA_URL}user/logout`,
    REGISTER: `${JAVA_URL}user/register`,  // 삭제 대상
    UPDATE: `${JAVA_URL}user/update`,
    WITHDRAW: `${JAVA_URL}user/withdraw`,
  },
};
```

**변경 후** (전체 교체):
```javascript
/**
 * API 설정 파일
 * Spring Boot 백엔드 연결을 위한 환경별 API URL 관리
 */

export const JAVA_URL = import.meta.env.VITE_API_URL || 'http://localhost:8080/';

export const API_ENDPOINTS = {
  // ========== 사용자 API ==========
  USER: {
    ME: `${JAVA_URL}api/users/me`,
    LOGOUT: `${JAVA_URL}api/users/logout`,
    WITHDRAW: `${JAVA_URL}api/users/me/withdraw`,
    DEACTIVATE: `${JAVA_URL}api/users/me/deactivate`,
    // 주의: REGISTER 없음 (OAuth2 자동 가입)
  },

  // ========== Eume AI 채팅 API ==========
  EUME_CHAT: {
    CREATE: `${JAVA_URL}api/eume-chats`,
    ME: `${JAVA_URL}api/eume-chats/me`,
    CONTENTS: (chatListId) => `${JAVA_URL}api/eume-chats/${chatListId}/contents`,
  },

  // ========== 다중 채팅 API ==========
  USER_CHAT: {
    LIST: `${JAVA_URL}api/user-chats`,
    CREATE: `${JAVA_URL}api/user-chats`,
    CONTENTS: (chatListId) => `${JAVA_URL}api/user-chats/${chatListId}/contents`,
  },

  // ========== 관리자 API ==========
  ADMIN: {
    LOGIN: `${JAVA_URL}api/admin/login`,
    LOGOUT: `${JAVA_URL}api/admin/logout`,
    REGISTER: `${JAVA_URL}api/admin/register`,
    ORGS: `${JAVA_URL}api/admin/orgs`,  // 무인증 API
    USERS: `${JAVA_URL}api/admin/users`,
    USER_DETAIL: (userId) => `${JAVA_URL}api/admin/users/${userId}`,
    USER_STATUS: (userId) => `${JAVA_URL}api/admin/users/${userId}/status`,
    USER_EMOTIONS: (userId) => `${JAVA_URL}api/admin/users/${userId}/emotions`,
    USERS_EXPORT: `${JAVA_URL}api/admin/users/export`,
    REPORTS_SUMMARY: `${JAVA_URL}api/admin/reports/summary`,
    REPORTS_EXPORT: `${JAVA_URL}api/admin/reports/export`,
  },
};

export const API_CONFIG = {
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json',
  },
};
```

---

### 3.2 [긴급] Axios 인스턴스 수정

**파일**: `src/shared/api/axios.js`

**변경 후** (전체 교체):
```javascript
/**
 * Axios 인스턴스 설정
 * - withCredentials: true (HttpOnly 쿠키 인증)
 * - 응답 인터셉터: response.data 반환 (기존 호출부 호환)
 * - 상태코드 분기 필요 시 axiosRaw 사용
 */
import axios from 'axios';
import { JAVA_URL, API_CONFIG } from './config';

const axiosInstance = axios.create({
  baseURL: JAVA_URL,
  timeout: API_CONFIG.timeout,
  headers: API_CONFIG.headers,
  withCredentials: true,  // HttpOnly 쿠키 인증
});

// 요청 인터셉터
axiosInstance.interceptors.request.use(
  (config) => {
    // 쿠키 기반 인증이므로 Authorization 헤더 불필요
    // 필요 시 여기에 요청 로깅 추가
    return config;
  },
  (error) => Promise.reject(error)
);

// 응답 인터셉터
axiosInstance.interceptors.response.use(
  (response) => {
    // 기존 호출부 호환을 위해 response.data 반환
    return response.data;
  },
  (error) => {
    // 401 에러 시 로그인 페이지로 리다이렉트
    if (error.response?.status === 401) {
      const isAdmin = window.location.pathname.startsWith('/admin');
      window.location.href = isAdmin ? '/admin/login' : '/user/login';
    }

    // 에러 로깅
    if (error.response) {
      console.error(`API Error [${error.response.status}]:`, error.response.data);
    } else if (error.request) {
      console.error('No response from server:', error.request);
    } else {
      console.error('Request error:', error.message);
    }

    return Promise.reject(error);
  }
);

export default axiosInstance;
```

---

### 3.3 [긴급] axiosRaw 인스턴스 생성 (신규 파일)

**파일**: `src/shared/api/axiosRaw.js` (신규 생성)

**용도**: 상태코드 분기가 필요한 API 호출용

**대상 API**:
| API | 상태코드 | 용도 |
|-----|---------|------|
| `POST /api/admin/login` | 200/401 | 로그인 성공/실패 |
| `POST /api/admin/register` | 201/400/409 | 회원가입 |
| `POST /api/eume-chats` | 201/409 | 채팅방 생성/이미 존재 |
| `POST /api/users/me/deactivate` | 200/409 | 비활성화/이미 비활성화 |

**코드**:
```javascript
/**
 * Axios Raw 인스턴스
 * - 인터셉터 없이 원본 응답 반환
 * - 상태코드 분기가 필요한 API에서만 사용
 *
 * 사용 예시:
 * const response = await axiosRaw.post(API_ENDPOINTS.ADMIN.LOGIN, data);
 * if (response.status === 200) { ... }
 */
import axios from 'axios';
import { JAVA_URL, API_CONFIG } from './config';

const axiosRaw = axios.create({
  baseURL: JAVA_URL,
  timeout: API_CONFIG.timeout,
  headers: API_CONFIG.headers,
  withCredentials: true,
});

export default axiosRaw;
```

---

### 3.4 [긴급] 관리자 로그인 수정

**파일**: `src/admin/pages/Login.jsx`

**현재 문제**:
1. 요청 형식이 백엔드와 불일치 (`loginId` → `adminLoginId`, `password` → `adminPw`)
2. `sigunguId` (소속기관) 누락
3. `/api/` 프리픽스 누락

**수정 내용**:

#### 3.4.1 상태 추가
```javascript
// 기존 상태
const [formData, setFormData] = useState({
  username: '',
  password: '',
  rememberMe: false
});

// 추가할 상태
const [formData, setFormData] = useState({
  sigunguId: '',      // 추가: 소속기관 ID
  username: '',
  password: '',
  rememberMe: false
});
const [orgs, setOrgs] = useState([]);           // 추가: 기관 목록
const [orgsLoading, setOrgsLoading] = useState(true);  // 추가: 로딩 상태
const [orgsError, setOrgsError] = useState(''); // 추가: 에러 상태
```

#### 3.4.2 기관 목록 로드 (useEffect 추가)
```javascript
import axiosRaw from '@shared/api/axiosRaw';
import { API_ENDPOINTS } from '@shared/api/config';

// 컴포넌트 내부에 추가
useEffect(() => {
  loadOrganizations();
}, []);

const loadOrganizations = async () => {
  setOrgsLoading(true);
  setOrgsError('');

  try {
    // GET /api/admin/orgs (무인증 API)
    const response = await axiosRaw.get(API_ENDPOINTS.ADMIN.ORGS);
    setOrgs(response.data);  // [{ id: 1, name: "서울시 강남구" }, ...]
  } catch (error) {
    console.error('기관 목록 로드 실패:', error);
    setOrgsError('기관 목록을 불러올 수 없습니다. 잠시 후 다시 시도해주세요.');
  } finally {
    setOrgsLoading(false);
  }
};
```

#### 3.4.3 handleSubmit 수정
```javascript
const handleSubmit = async (e) => {
  e.preventDefault();

  // 유효성 검사 (소속기관 추가)
  if (!formData.sigunguId) {
    setErrorMessage('소속 기관을 선택해주세요.');
    return;
  }

  if (!formData.username.trim()) {
    setErrorMessage('아이디를 입력해주세요.');
    return;
  }

  if (!formData.password) {
    setErrorMessage('비밀번호를 입력해주세요.');
    return;
  }

  setIsLoading(true);

  try {
    // axiosRaw 사용 (상태코드 분기 필요)
    const response = await axiosRaw.post(API_ENDPOINTS.ADMIN.LOGIN, {
      sigunguId: parseInt(formData.sigunguId),  // 숫자로 변환
      adminLoginId: formData.username,
      adminPw: formData.password
    });

    if (response.status === 200) {
      const result = response.data;

      // 사용자 정보 저장 (토큰은 쿠키로 자동 설정됨)
      const userData = {
        id: result.id,
        adminName: result.adminName,
        adminEmail: result.adminEmail,
        lastLoginDate: result.lastLoginDate,
        sigunguId: formData.sigunguId
      };

      localStorage.setItem('eume_admin_user', JSON.stringify(userData));

      // 세션 만료 시간 설정
      const expiryTime = Date.now() + (formData.rememberMe ? 7 * 24 * 60 * 60 * 1000 : 2 * 60 * 60 * 1000);
      localStorage.setItem('eume_admin_session_expiry', expiryTime.toString());

      navigate('/admin/dashboard');
    }
  } catch (error) {
    console.error('로그인 오류:', error);

    if (error.response?.status === 401) {
      setErrorMessage('아이디 또는 비밀번호가 올바르지 않습니다.');
    } else {
      setErrorMessage(error.response?.data?.message || '로그인 중 오류가 발생했습니다.');
    }
    setIsLoading(false);
  }
};
```

#### 3.4.4 소속기관 선택 UI 추가 (폼에 추가)
```jsx
{/* 소속기관 선택 - 아이디 입력 위에 추가 */}
<div className="form-group">
  <label htmlFor="sigunguId">소속 기관</label>
  {orgsLoading ? (
    <p>기관 목록 로딩 중...</p>
  ) : orgsError ? (
    <div>
      <p className="error-text">{orgsError}</p>
      <button type="button" onClick={loadOrganizations}>재시도</button>
    </div>
  ) : (
    <select
      id="sigunguId"
      name="sigunguId"
      value={formData.sigunguId}
      onChange={handleChange}
      required
    >
      <option value="">소속 기관을 선택하세요</option>
      {orgs.map((org) => (
        <option key={org.id} value={org.id}>
          {org.name}
        </option>
      ))}
    </select>
  )}
</div>
```

---

### 3.5 [긴급] 온보딩 흐름 수정

**파일**: `src/user/pages/Onboarding4.jsx`

**현재 문제**:
1. `API_ENDPOINTS.USER.REGISTER` 호출 (백엔드에 없음)
2. OAuth2 사용자는 자동 가입되므로 `PUT /api/users/me`로 프로필 업데이트해야 함

**수정 내용**:

#### 3.5.1 import 추가
```javascript
import axiosInstance from '@shared/api/axios';
import { API_ENDPOINTS } from '@shared/api/config';
import { toBackendTheme } from '@shared/utils/themeMapper';  // 신규 파일
```

#### 3.5.2 handleComplete 수정
```javascript
const handleComplete = async () => {
  try {
    // localStorage에서 사용자 정보 가져오기
    const oauthUser = JSON.parse(localStorage.getItem('oauth_user') || '{}');
    const userName = localStorage.getItem('eume_realName') || oauthUser.name || '';
    const nickname = localStorage.getItem('eume_userName') || userName;
    const birthDate = localStorage.getItem('eume_birthDate') || '';
    const gender = localStorage.getItem('eume_gender') || '';
    const phone = localStorage.getItem('eume_phone') || '';

    // 프로필 업데이트 데이터 구성
    const updateData = {
      userName: userName,
      nickName: nickname,  // camelCase 주의
      birthDate: birthDate || null,  // YYYY-MM-DD 형식
      gender: gender ? gender.toUpperCase() : null,  // MALE/FEMALE/OTHER (백엔드 확인 필요)
      phone: phone ? phone.replace(/-/g, '') : null,  // 하이픈 제거
      backgroundTheme: toBackendTheme(selectedTheme),  // 테마 매핑
    };

    // PUT /api/users/me 호출
    await axiosInstance.put(API_ENDPOINTS.USER.ME, updateData);

    // 테마 및 상태 저장
    localStorage.setItem('eume_theme', selectedTheme);
    localStorage.setItem('eume_visited', 'true');
    localStorage.setItem('eume_onboarding_complete', 'true');

    // 임시 데이터 삭제
    localStorage.removeItem('oauth_user');
    localStorage.removeItem('eume_email');
    localStorage.removeItem('eume_realName');
    localStorage.removeItem('eume_userName');
    localStorage.removeItem('eume_birthDate');
    localStorage.removeItem('eume_gender');
    localStorage.removeItem('eume_phone');

    // 홈으로 이동
    navigate('/user/home');
  } catch (error) {
    console.error('프로필 업데이트 오류:', error);

    if (error.response?.status === 400) {
      alert('입력한 정보를 확인해주세요.');
    } else if (error.response?.status === 401) {
      alert('로그인이 필요합니다.');
      navigate('/user/login');
    } else {
      alert(error.response?.data?.message || '프로필 저장 중 오류가 발생했습니다.');
    }
  }
};
```

---

### 3.6 [높음] OAuth2 리다이렉트 수정

**파일**: `src/user/pages/OAuth2Redirect.jsx`

**현재 문제**: `fetch` 직접 사용으로 인터셉터/에러 처리 일관성 부족

**수정 내용**:
```javascript
// 기존 코드 (fetch 사용)
const response = await fetch('/api/users/me', {
  method: 'GET',
  credentials: 'include',
});
const userData = await response.json();

// 수정 후 (axiosInstance 사용)
import axiosInstance from '@shared/api/axios';
import { API_ENDPOINTS } from '@shared/api/config';

// ...

const userData = await axiosInstance.get(API_ENDPOINTS.USER.ME);
// axiosInstance가 response.data를 반환하므로 바로 사용 가능
```

---

### 3.7 [높음] 테마 매핑 유틸리티 생성

**파일**: `src/shared/utils/themeMapper.js` (신규 생성)

```javascript
/**
 * 테마 매핑 유틸리티
 * 프론트엔드 테마 ↔ 백엔드 테마 변환
 *
 * 프론트엔드: ocean, sunset, forest, lavender, rose
 * 백엔드: DEFAULT, DARK, LIGHT
 */

const FRONTEND_TO_BACKEND = {
  ocean: 'DEFAULT',
  sunset: 'DARK',
  forest: 'LIGHT',
  lavender: 'DEFAULT',  // 매핑 없음, 기본값 사용
  rose: 'DEFAULT',      // 매핑 없음, 기본값 사용
};

const BACKEND_TO_FRONTEND = {
  DEFAULT: 'ocean',
  DARK: 'sunset',
  LIGHT: 'forest',
};

/**
 * 프론트엔드 테마를 백엔드 테마로 변환
 * @param {string} frontendTheme - 프론트엔드 테마 (ocean, sunset, forest, lavender, rose)
 * @returns {string} 백엔드 테마 (DEFAULT, DARK, LIGHT)
 */
export const toBackendTheme = (frontendTheme) => {
  return FRONTEND_TO_BACKEND[frontendTheme] || 'DEFAULT';
};

/**
 * 백엔드 테마를 프론트엔드 테마로 변환
 * @param {string} backendTheme - 백엔드 테마 (DEFAULT, DARK, LIGHT)
 * @returns {string} 프론트엔드 테마 (ocean, sunset, forest)
 */
export const toFrontendTheme = (backendTheme) => {
  return BACKEND_TO_FRONTEND[backendTheme] || 'ocean';
};

// 프론트엔드 지원 테마 목록
export const FRONTEND_THEMES = ['ocean', 'sunset', 'forest', 'lavender', 'rose'];

// 백엔드 지원 테마 목록
export const BACKEND_THEMES = ['DEFAULT', 'DARK', 'LIGHT'];
```

---

### 3.8 [높음] localStorage 키 상수 정의

**파일**: `src/shared/constants/storage.js` (신규 생성)

```javascript
/**
 * localStorage 키 상수
 * 일관된 키 사용을 위해 상수로 정의
 */

export const STORAGE_KEYS = {
  // ========== 사용자 ==========
  USER_INFO: 'eume_user',              // 사용자 기본 정보 (JSON)
  USER_THEME: 'eume_theme',            // 선택한 테마
  USER_VISITED: 'eume_visited',        // 방문 여부
  USER_ONBOARDING: 'eume_onboarding_complete',  // 온보딩 완료 여부

  // OAuth2 임시 데이터
  OAUTH_USER: 'oauth_user',            // OAuth2 사용자 정보 (임시)
  OAUTH_EMAIL: 'eume_email',
  OAUTH_REALNAME: 'eume_realName',
  OAUTH_USERNAME: 'eume_userName',
  OAUTH_BIRTHDATE: 'eume_birthDate',
  OAUTH_GENDER: 'eume_gender',
  OAUTH_PHONE: 'eume_phone',

  // ========== 관리자 ==========
  ADMIN_USER: 'eume_admin_user',       // 관리자 정보 (JSON)
  ADMIN_SESSION_EXPIRY: 'eume_admin_session_expiry',  // 세션 만료 시간
  ADMIN_LOGIN_HISTORY: 'eume_admin_login_history',    // 로그인 기록
};

/**
 * 삭제 대상 키 (더 이상 사용하지 않음)
 * - 'accessToken': axios.js에서 사용했으나 쿠키로 대체
 * - 'token': 쿠키로 대체
 * - 'eume_user_token': 쿠키로 대체
 * - 'user': eume_user로 통일
 */
```

---

## 4. 데이터 타입 정의 (Swagger 실측 기준)

### 4.1 사용자 API

```typescript
// GET /api/users/me 응답
interface EumeUserProfileResponse {
  email: string;
  userName: string;
  nickname: string;
  profileImage: string;
  sigungu: {
    sido: string;
    sigungu: string;
  };
  birthDate: string;          // YYYY-MM-DD
  gender: string;             // MALE/FEMALE/OTHER (백엔드 확인 필요)
  phone: string;
  lastLoginDate: string;      // ISO datetime
  backGroundTheme: 'DEFAULT' | 'DARK' | 'LIGHT';
  createdAt: string;
  updatedAt: string;
}

// PUT /api/users/me 요청
interface EumeUserUpdateRequest {
  userName?: string;
  nickName?: string;          // camelCase 주의 (nickname 아님)
  profileImage?: string;
  sigunguId?: number;
  birthDate?: string;         // YYYY-MM-DD
  gender?: string;            // MALE/FEMALE/OTHER (백엔드 확인 필요)
  phone?: string;             // 형식 확인 필요
  backgroundTheme?: 'DEFAULT' | 'DARK' | 'LIGHT';
}
```

### 4.2 관리자 API

```typescript
// GET /api/admin/orgs 응답 (무인증)
interface AdminOrgResponse {
  id: number;
  name: string;
}

// POST /api/admin/login 요청
interface AdminLoginRequest {
  sigunguId: number;     // 필수
  adminLoginId: string;  // 필수
  adminPw: string;       // 필수
}

// POST /api/admin/login 응답
interface AdminLoginResponse {
  id: number;
  adminName: string;
  adminEmail: string;
  lastLoginDate: string;  // ISO datetime
}

// POST /api/admin/register 요청
interface AdminRegisterRequest {
  sigunguId: number;       // 필수
  adminLoginId: string;    // 필수, 4-20자
  adminPw: string;         // 필수, 8-100자
  adminName: string;       // 필수
  adminEmail: string;      // 필수
  adminPhone?: string;     // 선택
}
```

### 4.3 채팅 API

```typescript
// GET /api/eume-chats/me 응답
interface EumeChatListDetailResponse {
  id: number;
  chatStatus: string;
  createdAt: string;
  updatedAt: string;
}

// POST /api/eume-chats/{chatListId}/contents 요청
interface EumeChatContentCreateRequest {
  messageContent: string;  // 필수
}

// POST /api/eume-chats/{chatListId}/contents 응답
interface EumeChatContentCreateResponse {
  userMessage: {
    id: number;
    messageType: string;
    messageContent: string;
    createdAt: string;
  };
  eumeMessage: {
    id: number;
    messageType: string;
    messageContent: string;
    createdAt: string;
  };
}

// POST /api/user-chats 요청
interface UserChatListCreateRequest {
  roomTitle: string;  // 필수, max 100자
}

// POST /api/user-chats/{chatListId}/contents 요청
interface UserChatContentCreateRequest {
  messageContent: string;  // 필수
  messageType: string;     // 필수
}
```

### 4.4 페이지네이션

```typescript
// 쿼리 파라미터
interface PaginationParams {
  page?: number;   // default: 0
  size?: number;   // default: 20
}

// 응답 공통 구조
interface PaginatedResponse<T> {
  [dataKey: string]: T[];  // users, chatRooms, contents, emotions 등
  currentPage: number;
  totalPages: number;
  totalElements: number;
  hasNext: boolean;
  hasPrevious: boolean;
}
```

---

## 5. 상태코드 처리 가이드

### 5.1 Swagger 기준 상태코드 (확정)

| API | 상태코드 | 설명 |
|-----|---------|------|
| `POST /api/eume-chats` | 201 | 채팅방 생성 성공 |
| `POST /api/eume-chats` | 409 | 이미 채팅방이 존재함 |
| `POST /api/users/me/deactivate` | 200 | 비활성화 성공 |
| `POST /api/users/me/deactivate` | 409 | 이미 비활성화된 계정 |
| `POST /api/user-chats` | 201 | 채팅방 생성 성공 |
| `POST /api/user-chats/{id}/contents` | 201 | 메시지 발송 성공 |

### 5.2 상태코드 분기 예시

```javascript
import axiosRaw from '@shared/api/axiosRaw';
import axiosInstance from '@shared/api/axios';

// 채팅방 생성 (409 처리 필요)
const createOrGetChatRoom = async () => {
  try {
    const response = await axiosRaw.post(API_ENDPOINTS.EUME_CHAT.CREATE);
    // 201: 새 채팅방 생성됨
    return response.data;
  } catch (error) {
    if (error.response?.status === 409) {
      // 이미 존재 → 기존 채팅방 조회
      const existing = await axiosInstance.get(API_ENDPOINTS.EUME_CHAT.ME);
      return existing;
    }
    throw error;
  }
};
```

---

## 6. 환경 설정

### 6.1 `.env.example` 업데이트

```env
# API Configuration
VITE_API_URL=http://localhost:8080/

# Environment
VITE_ENV=development

# 배포 환경별 예시
# VITE_API_URL=https://api.eume.example.com/  # Production
# VITE_API_URL=https://staging-api.eume.example.com/  # Staging
```

### 6.2 CORS 설정 (백엔드 전달용)

```
# 개발 환경
Access-Control-Allow-Origin: http://localhost:3000
Access-Control-Allow-Credentials: true
Access-Control-Allow-Methods: GET, POST, PUT, PATCH, DELETE, OPTIONS
Access-Control-Allow-Headers: Content-Type

# 운영 환경
Access-Control-Allow-Origin: https://eume.example.com
Access-Control-Allow-Credentials: true
Access-Control-Allow-Methods: GET, POST, PUT, PATCH, DELETE, OPTIONS
Access-Control-Allow-Headers: Content-Type
```

---

## 7. 검증 체크리스트

### 7.1 구현 후 기능 검증

- [ ] 관리자 로그인 (소속기관 선택 → 로그인 성공)
- [ ] 관리자 로그인 실패 시 에러 메시지 표시
- [ ] 사용자 OAuth2 로그인 → 프로필 조회 성공
- [ ] 사용자 온보딩 완료 → 프로필 업데이트 성공
- [ ] 사용자 테마 저장/조회 매핑 정상
- [ ] 401 에러 시 적절한 로그인 페이지로 리다이렉트

### 7.2 기술 검증 (Network 탭)

- [ ] 모든 API 요청에 `/api/` 프리픽스 포함
- [ ] 모든 요청에 쿠키가 포함됨 (withCredentials 확인)
- [ ] Authorization 헤더 없음 (쿠키로 대체)
- [ ] 관리자 로그인 요청 형식: `{ sigunguId, adminLoginId, adminPw }`

---

## 8. 미확정 사항 (백엔드 확인 필요)

| 항목 | 현재 추정값 | 확인 필요 |
|------|-----------|----------|
| gender enum | MALE / FEMALE / OTHER | Swagger에 enum 없음 |
| phone 형식 | 01012345678 (하이픈 없음) | 형식 검증 규칙 확인 |
| 관리자 로그인 상태코드 | 200/401 | Swagger에 명시 없음 |

---

## 변경 이력

| 날짜 | 버전 | 작성자 | 내용 |
|------|------|--------|------|
| 2025-11-28 | 1.0 | Claude | 원본 계획서 작성 |
| 2025-11-28 | 2.0 | Claude | 통합 계획서 (001 파일 3개 통합) |
| 2025-11-28 | 3.0 | Claude | 최종 계획서 (Round 1-4 토론 결과 반영) |
