# 006. 백엔드 연동 추가 구현 계획서

## 1. 현황 분석

### 1.1 API 엔드포인트 구현 현황

#### USER API (사용자 API)
| 엔드포인트 | 상태 | 사용처 | 비고 |
|-----------|------|--------|------|
| `GET /api/users/me` | ✅ 구현됨 | Login.jsx, Settings.jsx | 사용자 정보 조회 |
| `POST /api/users/logout` | ✅ 구현됨 | Sidebar.jsx | 로그아웃 |
| `DELETE /api/users/me/withdraw` | ✅ 구현됨 | Settings.jsx | 회원 탈퇴 |
| `PUT /api/users/me/deactivate` | ✅ 구현됨 | Settings.jsx | 계정 비활성화 |

#### EUME_CHAT API (이음이 AI 채팅 API)
| 엔드포인트 | 상태 | 사용처 | 비고 |
|-----------|------|--------|------|
| `POST /api/eume-chats` | ✅ 구현됨 | Home.jsx | 새 채팅 생성 |
| `GET /api/eume-chats/me` | ✅ 구현됨 | Home.jsx | 내 채팅 목록 |
| `GET /api/eume-chats/{id}/contents` | ✅ 구현됨 | Home.jsx | 채팅 내용 조회 |

#### USER_CHAT API (다중 채팅 API) - ⚠️ 미구현
| 엔드포인트 | 상태 | 필요 사용처 | 비고 |
|-----------|------|-------------|------|
| `GET /api/user-chats` | ❌ 미구현 | Sidebar, Home | 사용자 채팅방 목록 |
| `POST /api/user-chats` | ❌ 미구현 | Sidebar, Home | 새 채팅방 생성 |
| `GET /api/user-chats/{id}/contents` | ❌ 미구현 | Home | 채팅방 대화 내용 |

#### ADMIN API (관리자 API)
| 엔드포인트 | 상태 | 사용처 | 비고 |
|-----------|------|--------|------|
| `POST /api/admin/login` | ✅ 구현됨 | Login.jsx | 관리자 로그인 |
| `POST /api/admin/logout` | ✅ 구현됨 | AdminLayout.jsx | 관리자 로그아웃 |
| `POST /api/admin/register` | ✅ 구현됨 | Login.jsx | 관리자 회원가입 |
| `GET /api/admin/orgs` | ✅ 구현됨 | Login.jsx | 복지기관 목록 |
| `GET /api/admin/users` | ✅ 구현됨 | Users.jsx | 이용자 목록 |
| `GET /api/admin/users/{id}` | ✅ 구현됨 | Users.jsx | 이용자 상세 |
| `PUT /api/admin/users/{id}/status` | ❌ 미구현 | Users.jsx | 이용자 상태 변경 |
| `GET /api/admin/users/{id}/emotions` | ❌ 미구현 | EmotionMonitor.jsx | 이용자 감정 데이터 |
| `GET /api/admin/users/export` | ✅ 구현됨 | Users.jsx | 이용자 Excel 내보내기 |
| `GET /api/admin/reports/summary` | ✅ 구현됨 | Dashboard.jsx | 리포트 요약 |
| `GET /api/admin/reports/export` | ✅ 구현됨 | Dashboard.jsx | 리포트 Excel 내보내기 |

---

### 1.2 페이지별 Mock 데이터 사용 현황

#### 관리자 페이지
| 페이지 | 파일 | 현재 상태 | Mock 데이터 항목 |
|--------|------|----------|-----------------|
| 대화 분석 | `Conversation.jsx` | ⚠️ 전체 Mock | 대화 통계, 대화 목록, 키워드, 감정 분석 |
| 긴급 상황 | `Emergency.jsx` | ⚠️ 전체 Mock | 긴급 알림, 활성 사용자, 실시간 통계 |
| 감정 모니터 | `EmotionMonitor.jsx` | ⚠️ 전체 Mock | 감정 통계, 감정 분포, 이용자별 감정 |
| 대시보드 | `Dashboard.jsx` | ✅ API 연동 | - |
| 이용자 관리 | `Users.jsx` | ✅ API 연동 | - |
| 리포트 | `Reports.jsx` | 확인 필요 | - |

#### 사용자 페이지
| 페이지 | 파일 | 현재 상태 | 비고 |
|--------|------|----------|------|
| 홈 (채팅) | `Home.jsx` | ✅ API 연동 | EUME_CHAT API 사용 |
| 설정 | `Settings.jsx` | ✅ API 연동 | USER API 사용 |
| 로그인 | `Login.jsx` | ✅ API 연동 | OAuth2 + USER.ME |

---

## 2. 구현 필요 항목

### 2.1 우선순위 1 (핵심 기능)

#### P1-1. USER_CHAT API 연동 - 다중 채팅방 기능

**현재 상태:**
- Sidebar.jsx의 pinnedRooms가 하드코딩되어 있음
- "새 채팅", "정책 정보", "이음이 톡" 버튼이 있지만, 실제 채팅방 관리 기능 없음
- 채팅 기록이 세션 간 유지되지 않는 구조

**구현 내용:**
1. 사용자 채팅방 목록 조회 (`GET /api/user-chats`)
2. 새 채팅방 생성 (`POST /api/user-chats`)
3. 채팅방별 대화 내용 조회 (`GET /api/user-chats/{id}/contents`)
4. Sidebar에 실제 채팅 히스토리 표시
5. 채팅방 전환 기능

**영향 파일:**
- `src/user/components/Sidebar.jsx`
- `src/user/pages/Home.jsx`
- `src/shared/api/config.js` (이미 정의됨)

**예상 작업량:** 중간 (3-4일)

---

#### P1-2. Admin 감정 모니터링 API 연동

**현재 상태:**
- EmotionMonitor.jsx가 전체 하드코딩된 Mock 데이터 사용
- `API_ENDPOINTS.ADMIN.USER_EMOTIONS` 정의되어 있으나 미사용

**구현 내용:**
1. 전체 이용자 감정 현황 조회 API 필요 (백엔드 확인 필요)
2. 개별 이용자 감정 데이터 조회 (`GET /api/admin/users/{id}/emotions`)
3. 감정 통계 집계 (프론트엔드 또는 백엔드)
4. 감정 분포 차트 실데이터 연동
5. 이용자별 감정 현황 테이블 실데이터 연동

**백엔드 확인 필요:**
- 전체 감정 통계 집계 API 존재 여부
- 감정 데이터 응답 형식

**영향 파일:**
- `src/admin/pages/EmotionMonitor.jsx`

**예상 작업량:** 중간 (2-3일)

---

### 2.2 우선순위 2 (보조 기능)

#### P2-1. Admin 대화 분석 API 연동

**현재 상태:**
- Conversation.jsx가 전체 하드코딩된 Mock 데이터 사용
- 대화 통계, 대화 목록, 감정 분석, 키워드 추출 등 복잡한 데이터 구조

**구현 내용:**
1. 대화 목록 조회 API 연동 (백엔드 API 확인 필요)
2. 대화 상세 조회 기능
3. 대화 통계 (총 대화 수, 평균 메시지 수 등)
4. 감정 분석 결과 표시
5. 키워드 추출 결과 표시
6. 필터링/검색 기능

**백엔드 확인 필요:**
- 관리자용 대화 조회 API 존재 여부
- 대화 분석 (감정, 키워드) API 존재 여부

**영향 파일:**
- `src/admin/pages/Conversation.jsx`

**예상 작업량:** 높음 (4-5일)

---

#### P2-2. Admin 긴급 상황 모니터링 API 연동

**현재 상태:**
- Emergency.jsx가 전체 Mock 데이터 사용
- 실시간 업데이트가 랜덤 데이터로 시뮬레이션됨
- 긴급 알림, 활성 사용자 모두 가짜 데이터

**구현 내용:**
1. 긴급 상황 목록 조회 API 연동 (백엔드 API 확인 필요)
2. 긴급 상황 상태 변경 API
3. 실시간 활성 사용자 조회
4. WebSocket 또는 Polling 기반 실시간 업데이트
5. 알림 발송 기능 (필요 시)

**백엔드 확인 필요:**
- 긴급 상황 관련 API 존재 여부
- 실시간 데이터 전송 방식 (WebSocket/SSE/Polling)

**영향 파일:**
- `src/admin/pages/Emergency.jsx`

**예상 작업량:** 높음 (5-7일, 실시간 기능 포함)

---

#### P2-3. Admin 이용자 상태 관리 API 연동

**현재 상태:**
- `API_ENDPOINTS.ADMIN.USER_STATUS` 정의되어 있으나 미사용
- Users.jsx에서 상태 변경 기능 UI는 있을 수 있으나 API 미연동

**구현 내용:**
1. 이용자 상태 변경 (`PUT /api/admin/users/{id}/status`)
2. 상태 변경 사유 입력 (필요 시)
3. 상태 변경 히스토리 조회 (백엔드 API 확인)

**영향 파일:**
- `src/admin/pages/Users.jsx`

**예상 작업량:** 낮음 (1일)

---

### 2.3 우선순위 3 (추가 개선)

#### P3-1. 채팅 유형별 분기 처리

**현재 상태:**
- Sidebar의 pinnedRooms에 "새 채팅", "정책 정보", "이음이 톡" 세 가지 유형 정의
- 모두 동일한 EUME_CHAT API 사용

**구현 내용:**
1. 채팅 유형에 따른 다른 API 호출 또는 파라미터 전달
2. "정책 정보" - 정책 RAG 기반 채팅
3. "이음이 톡" - 자동 상담 모드
4. 각 유형별 UI 차별화

**백엔드 확인 필요:**
- 채팅 유형 파라미터 지원 여부
- 정책 RAG, 자동 상담 모드 API 차이

**예상 작업량:** 중간 (2-3일)

---

#### P3-2. 오프라인/에러 상태 처리 개선

**현재 상태:**
- 기본적인 에러 처리만 구현
- 네트워크 오프라인 시 처리 부족

**구현 내용:**
1. 네트워크 상태 감지
2. 오프라인 시 사용자 알림
3. 재연결 시 자동 데이터 동기화
4. API 요청 재시도 로직

**영향 파일:**
- `src/shared/api/axios.js`
- 전역 에러 처리 컴포넌트 추가

**예상 작업량:** 중간 (2일)

---

## 3. 백엔드 API 확인 필요 사항

Swagger 문서 확인이 필요한 항목들:

### 3.1 존재 여부 확인 필요
1. **대화 분석 관련**
   - 관리자용 전체 대화 목록 조회 API
   - 대화 감정 분석 결과 API
   - 대화 키워드 추출 API
   - 대화 통계 집계 API

2. **긴급 상황 관련**
   - 긴급 알림 목록 조회 API
   - 긴급 알림 상태 변경 API
   - 실시간 활성 사용자 API
   - 실시간 데이터 전송 방식

3. **감정 모니터링 관련**
   - 전체 감정 통계 집계 API
   - 감정 분포 데이터 API

### 3.2 응답 형식 확인 필요
1. `GET /api/admin/users/{id}/emotions` - 감정 데이터 형식
2. `PUT /api/admin/users/{id}/status` - 요청/응답 형식
3. `GET /api/user-chats` - 채팅방 목록 형식
4. `GET /api/user-chats/{id}/contents` - 대화 내용 형식

---

## 4. 구현 순서 제안

### Phase 1: 핵심 사용자 기능 (1주차)
1. P1-1. USER_CHAT API 연동 (다중 채팅방)
   - 사용자 채팅 경험의 핵심 기능
   - 채팅 히스토리 유지

### Phase 2: 관리자 모니터링 기능 (2주차)
2. P1-2. 감정 모니터링 API 연동
3. P2-3. 이용자 상태 관리 API 연동
   - 관리자 대시보드 기본 기능 완성

### Phase 3: 관리자 분석 기능 (3주차)
4. P2-1. 대화 분석 API 연동
5. P2-2. 긴급 상황 모니터링 API 연동
   - 실시간 기능 포함, 복잡도 높음

### Phase 4: 추가 개선 (4주차)
6. P3-1. 채팅 유형별 분기 처리
7. P3-2. 오프라인/에러 상태 처리 개선

---

## 5. 기술적 고려사항

### 5.1 인증 방식
- 현재: HttpOnly 쿠키 기반 인증 (`withCredentials: true`)
- 401 에러 시 로그인 페이지 리다이렉트 (axios 인터셉터)
- 로그인 페이지에서는 리다이렉트 예외 처리 완료

### 5.2 실시간 기능
- Emergency.jsx의 실시간 업데이트 구현 시:
  - WebSocket: 양방향 실시간 통신
  - SSE (Server-Sent Events): 단방향 서버→클라이언트
  - Polling: 주기적 API 호출 (현재 Mock 구현 방식)
- 백엔드 지원 방식에 따라 결정

### 5.3 상태 관리
- 현재: React 컴포넌트 로컬 상태 + localStorage
- 복잡한 상태 공유 필요 시 Context API 또는 상태 관리 라이브러리 검토

### 5.4 에러 처리
- API 에러 시 사용자 친화적 메시지 표시
- 재시도 로직 구현
- 로딩 상태 표시

---

## 6. 참고 파일

### API 관련
- `src/shared/api/config.js` - API 엔드포인트 정의
- `src/shared/api/axios.js` - Axios 인스턴스 및 인터셉터

### 사용자 페이지
- `src/user/pages/Home.jsx` - 채팅 메인 페이지
- `src/user/components/Sidebar.jsx` - 사이드바 (채팅방 목록)
- `src/user/pages/Settings.jsx` - 설정 페이지

### 관리자 페이지
- `src/admin/pages/Dashboard.jsx` - 대시보드
- `src/admin/pages/Users.jsx` - 이용자 관리
- `src/admin/pages/Conversation.jsx` - 대화 분석 (Mock)
- `src/admin/pages/Emergency.jsx` - 긴급 상황 (Mock)
- `src/admin/pages/EmotionMonitor.jsx` - 감정 모니터링 (Mock)

---

## 7. 변경 이력

| 날짜 | 버전 | 작성자 | 내용 |
|------|------|--------|------|
| 2025-11-28 | 1.0 | Claude | 초안 작성 |
