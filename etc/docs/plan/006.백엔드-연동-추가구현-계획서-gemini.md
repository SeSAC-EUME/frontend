# 006. 백엔드 연동 추가 구현 계획서

**작성자**: Gemini
**작성일**: 2025년 11월 28일

## 1. 현황 분석

현재 프론트엔드 프로젝트와 백엔드 API 명세(`src/shared/api/config.js`)를 비교 분석한 결과, 연동이 완료/진행 중인 기능과 아직 연동이 필요한 기능은 다음과 같습니다.

| 구분 | API 엔드포인트 | 구현 상태 | 관련 페이지/컴포넌트 | 비고 |
| --- | --- | --- | --- | --- |
| **공통/사용자** | | | | |
| | `USER.ME` (GET/PUT) | **구현 완료** | `OAuth2Redirect`, `Onboarding4`, `Settings` | 사용자 정보 조회 및 수정 |
| | `USER.LOGOUT` (POST) | **구현 완료** | `Settings`, `Sidebar` | |
| | `USER.WITHDRAW` (POST) | **미구현** | `Settings` | 회원 탈퇴 기능 필요 |
| | `USER.DEACTIVATE` (POST) | **미구현** | `Settings` | 계정 비활성화 기능 필요 |
| | | | | |
| **AI 채팅** | | | | |
| | `EUME_CHAT.CREATE` (POST) | **구현 완료** | `Home` | 채팅방 자동 생성 |
| | `EUME_CHAT.ME` (GET) | **구현 완료** | `Home` | 채팅방 ID 조회 |
| | `EUME_CHAT.CONTENTS` (POST) | **구현 완료** | `Home` | 메시지 전송 |
| | `EUME_CHAT.CONTENTS` (GET) | **미구현** | `Home` | **과거 대화 내역 로딩 기능 누락** |
| | | | | |
| **일반 채팅** | | | | **전체 미구현** |
| | `USER_CHAT.LIST` (GET) | **미구현** | `Home` (사이드바) | 일반 채팅방 목록 조회 |
| | `USER_CHAT.CREATE` (POST) | **미구현** | - | 새 일반 채팅방 생성 |
| | `USER_CHAT.CONTENTS` (GET/POST) | **미구현** | `Home` | 일반 채팅 메시지 송수신 |
| | | | | |
| **관리자** | | | | |
| | `ADMIN.LOGIN` (POST) | **구현 완료** | `Login` | |
| | `ADMIN.REGISTER` (POST) | **구현 완료** | `Login` | |
| | `ADMIN.LOGOUT` (POST) | **구현 완료** | `AdminLayout` | |
| | `ADMIN.ORGS` (GET) | **구현 완료** | `Login` | 기관 목록 조회 |
| | `ADMIN.USERS` (GET) | **구현 완료** | `Users` | 전체 사용자 목록 조회 |
| | `ADMIN.USERS_EXPORT` (GET) | **구현 완료** | `Users` | 사용자 목록 Excel 내보내기 |
| | `ADMIN.REPORTS_SUMMARY` (GET) | **구현 완료** | `Dashboard` | 대시보드 통계 요약 |
| | `ADMIN.REPORTS_EXPORT` (GET) | **구현 완료** | `Dashboard` | 전체 보고서 다운로드 |
| | `ADMIN.USER_DETAIL` (GET) | **미구현** | `Users` | **사용자 상세 정보 조회 기능 누락** |
| | `ADMIN.USER_STATUS` (PUT/PATCH) | **미구현** | `Users` (상세) | 사용자 상태 변경 (활성/비활성) |
| | `ADMIN.USER_EMOTIONS` (GET) | **미구현** | `EmotionMonitor` | 특정 사용자의 감정 데이터 조회 |
| | `ADMIN` (대화 분석) | **미구현** | `Conversation` | **API 명세 불분명** |
| | `ADMIN` (보고서) | **미구현** | `Reports` | **API 명세 불분명** |


## 2. 추가 구현 계획

위 현황 분석을 바탕으로, 다음과 같이 기능 구현 우선순위를 정하고 세부 계획을 수립합니다.

### **1순위: 핵심 기능 보완**

#### 1.1. Eume AI 채팅 - 과거 대화 내역 로딩
- **목표**: `Home` 페이지 진입 시, 기존 AI 채팅 내역을 불러와 표시한다.
- **세부 계획**:
    1. **(`Home.jsx`)** `loadExistingChat` 함수 수정.
    2. `EUME_CHAT.ME`로 `chatListId`를 받은 후, `EUME_CHAT.CONTENTS(chatListId)`에 `GET` 요청을 보내 과거 메시지 목록을 가져온다.
    3. 받아온 메시지 목록을 `messagesByRoom` 상태에 초기값으로 설정한다.
    4. 로딩 상태를 관리하여 사용자에게 피드백을 제공한다.

#### 1.2. 관리자 - 사용자 상세 정보 조회
- **목표**: `Users` 페이지에서 특정 사용자를 클릭하면, 해당 사용자의 상세 정보를 모달 또는 별도 페이지에서 확인할 수 있게 한다.
- **세부 계획**:
    1. **(`Users.jsx`)** 테이블의 사용자 행 클릭 시, 상세 정보 모달을 띄우는 `onClick` 이벤트 핸들러 추가.
    2. `ADMIN.USER_DETAIL(userId)` API를 호출하여 사용자 상세 정보(가입일, 마지막 접속일, 이메일 등)를 가져온다.
    3. `ADMIN.USER_EMOTIONS(userId)` API를 호출하여 해당 사용자의 최근 감정 변화 데이터를 가져온다.
    4. 가져온 정보들을 모달 컴포넌트에 표시한다.
    5. **(Optional)** `ADMIN.USER_STATUS` API와 연동하여 관리자가 사용자를 '활성/비활성' 상태로 변경할 수 있는 버튼을 모달 내에 구현한다.

---

### **2순위: 신규 핵심 기능 구현**

#### 2.1. 사용자 - 일반 채팅 (UserChat) 기능
- **목표**: 사용자가 AI가 아닌 다른 상담사/관리자와 일반 대화를 나눌 수 있는 기능을 구현한다.
- **세부 계획**:
    1. **(UI)** `Home` 페이지 사이드바에 'AI 채팅'과 '일반 채팅'을 구분할 수 있는 탭 또는 메뉴를 추가한다.
    2. **(API)** 사이드바 로드 시 `USER_CHAT.LIST` API를 호출하여 사용자가 참여 중인 일반 채팅방 목록을 가져온다.
    3. **(State)** 가져온 채팅방 목록을 상태로 관리하고 사이드바에 렌더링한다.
    4. **(UI/API)** 채팅방 클릭 시, `USER_CHAT.CONTENTS(chatListId)`에 `GET` 요청을 보내 해당 방의 메시지를 불러온다. 메시지 전송 시에는 `POST` 요청을 보낸다.
    5. `EumeChat`과 `UserChat`의 메시지 상태를 분리하여 관리하거나, 현재의 `messagesByRoom` 상태 구조를 확장하여 `roomId`로 구분하여 함께 관리한다.

#### 2.2. 관리자 - 감정 모니터링 페이지
- **목표**: `EmotionMonitor.jsx`의 정적 데이터를 실제 API 데이터로 교체한다.
- **세부 계획**:
    1. **(API)** 페이지 로드 시, 특정 기간 동안의 전체 사용자 감정 통계 API를 호출한다. (현재 API 명세에 이 기능이 없어 백엔드에 **API 추가 요청**이 필요할 수 있음. `REPORTS_SUMMARY`와 유사한 `EMOTIONS_SUMMARY` API 제안)
    2. **(API)** '이용자별 감정 현황' 테이블에 `ADMIN.USERS`로 사용자 목록을 가져오고, 각 사용자의 최근 감정 상태를 별도로 조회하거나(`ADMIN.USER_EMOTIONS`), `ADMIN.USERS` API 응답에 최근 감정 상태가 포함되도록 백엔드에 수정을 요청한다.
    3. **(UI)** API 응답 데이터를 기반으로 통계 카드, 감정 분포 차트, 사용자 테이블을 동적으로 렌더링하도록 코드를 수정한다.

---

### **3순위: 사용자 편의 기능 및 마무리**

#### 3.1. 사용자 - 계정 관리
- **목표**: `Settings` 페이지에 회원 탈퇴 및 계정 비활성화 기능을 추가한다.
- **세부 계획**:
    1. **(UI)** `Settings` 페이지 하단에 '계정 비활성화'와 '회원 탈퇴' 버튼을 추가한다.
    2. 각 버튼 클릭 시, 사용자에게 재확인하는 모달창을 표시한다.
    3. **(API)** '비활성화' 확인 시 `USER.DEACTIVATE` API를, '탈퇴' 확인 시 `USER.WITHDRAW` API를 호출한다.
    4. API 호출 성공 시, `localStorage`를 모두 비우고 로그인 페이지로 리다이렉트한다.

#### 3.2. API 명세가 불분명한 관리자 페이지 처리
- **목표**: `Conversation`, `Reports` 페이지의 기획을 명확히 하고 필요한 백엔드 API를 정의하여 구현한다.
- **세부 계획**:
    1. **(기획/백엔드 협의)**
        - **`Conversation`**: 모든 사용자의 대화를 검색하고 필터링하는 기능이 필요한지, 아니면 특정 사용자의 대화 내역을 상세 분석하는 기능인지 명확히 한다. 필요한 API(예: `GET /api/admin/conversations?userId=&...`)를 백엔드에 요청한다.
        - **`Reports`**: 정기적인 리포트를 시스템이 자동 생성하는 것인지, 관리자가 직접 기간과 종류를 설정하여 생성하는 것인지 정의한다. 리포트 목록 조회, 생성, 다운로드에 필요한 API를 백엔드에 요청한다.
    2. **(프론트엔드 구현)** 확정된 기획과 API 명세에 따라 페이지를 구현한다.

---
## 3. 결론

현재까지의 작업으로 인증 및 주요 페이지의 골격이 잘 잡혀있습니다. 이제 위 계획에 따라 **(1) 기존 기능 보완**, **(2) 핵심 신규 기능 구현**, **(3) 부가 기능 및 마무리** 순서로 진행하면 체계적으로 프로젝트를 완성할 수 있을 것입니다. 특히 API 명세가 불분명한 부분에 대해서는 조속한 기획/백엔드 파트와의 논의가 필요합니다.
