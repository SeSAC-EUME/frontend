# 백엔드-프론트엔드 연동 계획서

## 1. 개요

### 1.1 목적
Spring Boot 백엔드(8080 포트)와 React 프론트엔드(3000 포트) 간의 API 연동을 체계적으로 구현하기 위한 계획서입니다.

### 1.2 현재 상태
- **백엔드**: `http://localhost:8080` (Swagger 문서: `/swagger-ui/index.html`)
- **프론트엔드**: `http://localhost:3000` (Vite 개발 서버)
- **연동 상태**: 부분적 구현 (로그인, OAuth2 일부만 연동됨)

---

## 2. 현재 프론트엔드 API 구조 분석

### 2.1 기존 API 설정 (`src/shared/api/config.js`)
```javascript
// 현재 정의된 엔드포인트 (수정 필요)
ADMIN: {
  LOGIN: `${JAVA_URL}admin/login`,        // 실제: /api/admin/login
  REGISTER: `${JAVA_URL}admin/register`,  // 실제: /api/admin/register
  CHANGE_PASSWORD: `${JAVA_URL}admin/change-password`,
},
USER: {
  LOGOUT: `${JAVA_URL}user/logout`,       // 실제: /api/users/logout
  REGISTER: `${JAVA_URL}user/register`,
  UPDATE: `${JAVA_URL}user/update`,
  WITHDRAW: `${JAVA_URL}user/withdraw`,
}
```

### 2.2 현재 연동된 기능
| 파일 | API 호출 | 상태 |
|------|----------|------|
| `admin/pages/Login.jsx` | `axiosInstance.post(API_ENDPOINTS.ADMIN.LOGIN)` | 경로 수정 필요 |
| `user/pages/OAuth2Redirect.jsx` | `fetch('/api/users/me')` | 정상 |
| `user/pages/Onboarding4.jsx` | `axiosInstance.post(...)` | 확인 필요 |

### 2.3 문제점
1. **경로 불일치**: 현재 config.js는 `/admin/login` 형태, 백엔드는 `/api/admin/login` 형태
2. **미구현 API 다수**: 채팅, 감정분석, 보고서 등 핵심 API 미연동
3. **인증 방식 혼재**: 일부는 axiosInstance, 일부는 fetch 직접 사용

---

## 3. 백엔드 API 구조 (Swagger 기준)

### 3.1 API 태그 분류
| 태그 | 설명 | 인증 필요 |
|------|------|----------|
| Admin | 관리자 전용 API | O (일부 제외) |
| User | 사용자 관련 API | O |
| EumeChat | Eume AI 채팅 API | O |
| UserChat | 다중 채팅 API | O |

### 3.2 전체 엔드포인트 목록

#### User API
| 메소드 | 경로 | 설명 |
|--------|------|------|
| GET | `/api/users/me` | 나의 정보 조회 |
| PUT | `/api/users/me` | 나의 정보 수정 |
| POST | `/api/users/me/withdraw` | 계정 탈퇴 |
| POST | `/api/users/me/deactivate` | 계정 비활성화 |
| POST | `/api/users/logout` | 로그아웃 |

#### EumeChat API (메인 AI 채팅)
| 메소드 | 경로 | 설명 |
|--------|------|------|
| POST | `/api/eume-chats` | 채팅방 생성 (사용자당 1개) |
| GET | `/api/eume-chats/me` | 내 채팅방 조회 |
| GET | `/api/eume-chats/{chatListId}/contents` | 대화 내용 조회 (페이지네이션) |
| POST | `/api/eume-chats/{chatListId}/contents` | 메시지 발송 (AI 응답 포함) |

#### UserChat API (다중 채팅)
| 메소드 | 경로 | 설명 |
|--------|------|------|
| GET | `/api/user-chats` | 채팅방 목록 조회 |
| POST | `/api/user-chats` | 채팅방 생성 |
| GET | `/api/user-chats/{chatListId}/contents` | 메시지 목록 조회 |
| POST | `/api/user-chats/{chatListId}/contents` | 메시지 발송 |

#### Admin API
| 메소드 | 경로 | 설명 |
|--------|------|------|
| POST | `/api/admin/login` | 관리자 로그인 |
| POST | `/api/admin/logout` | 관리자 로그아웃 |
| POST | `/api/admin/register` | 관리자 회원가입 |
| GET | `/api/admin/orgs` | 소속 기관 목록 (인증 불필요) |
| GET | `/api/admin/users` | 사용자 목록 조회 |
| GET | `/api/admin/users/{userId}` | 사용자 상세 조회 |
| PATCH | `/api/admin/users/{userId}/status` | 사용자 상태 변경 |
| GET | `/api/admin/users/{userId}/emotions` | 사용자 감정 기록 조회 |
| GET | `/api/admin/users/export` | 이용자 데이터 Excel 내보내기 |
| GET | `/api/admin/reports/summary` | 보고서 요약 조회 |
| GET | `/api/admin/reports/export` | 보고서 Excel 다운로드 |

---

## 4. 연동 작업 계획

### 4.1 Phase 1: API 설정 리팩토링 (우선순위: 높음)

#### 작업 1.1: `src/shared/api/config.js` 수정
```javascript
// 수정된 API 엔드포인트 구조
export const API_ENDPOINTS = {
  // 사용자 API
  USER: {
    ME: `${JAVA_URL}api/users/me`,
    LOGOUT: `${JAVA_URL}api/users/logout`,
    WITHDRAW: `${JAVA_URL}api/users/me/withdraw`,
    DEACTIVATE: `${JAVA_URL}api/users/me/deactivate`,
  },

  // Eume AI 채팅 API
  EUME_CHAT: {
    CREATE: `${JAVA_URL}api/eume-chats`,
    ME: `${JAVA_URL}api/eume-chats/me`,
    CONTENTS: (chatListId) => `${JAVA_URL}api/eume-chats/${chatListId}/contents`,
  },

  // 다중 채팅 API
  USER_CHAT: {
    LIST: `${JAVA_URL}api/user-chats`,
    CREATE: `${JAVA_URL}api/user-chats`,
    CONTENTS: (chatListId) => `${JAVA_URL}api/user-chats/${chatListId}/contents`,
  },

  // 관리자 API
  ADMIN: {
    LOGIN: `${JAVA_URL}api/admin/login`,
    LOGOUT: `${JAVA_URL}api/admin/logout`,
    REGISTER: `${JAVA_URL}api/admin/register`,
    ORGS: `${JAVA_URL}api/admin/orgs`,
    USERS: `${JAVA_URL}api/admin/users`,
    USER_DETAIL: (userId) => `${JAVA_URL}api/admin/users/${userId}`,
    USER_STATUS: (userId) => `${JAVA_URL}api/admin/users/${userId}/status`,
    USER_EMOTIONS: (userId) => `${JAVA_URL}api/admin/users/${userId}/emotions`,
    USERS_EXPORT: `${JAVA_URL}api/admin/users/export`,
    REPORTS_SUMMARY: `${JAVA_URL}api/admin/reports/summary`,
    REPORTS_EXPORT: `${JAVA_URL}api/admin/reports/export`,
  },
};
```

#### 작업 1.2: Axios 인스턴스 설정 확인
- `credentials: 'include'` 설정 확인 (쿠키 기반 인증)
- 토큰 저장 위치 통일 (`accessToken` vs `eume_user_token`)
- 에러 핸들링 개선

### 4.2 Phase 2: 사용자 앱 연동 (우선순위: 높음)

#### 작업 2.1: 사용자 인증 흐름 정리
| 페이지 | 연동 작업 |
|--------|----------|
| Login.jsx | OAuth2 소셜 로그인 연동 유지 |
| OAuth2Redirect.jsx | `/api/users/me` 호출 (완료) |
| Settings.jsx | 프로필 조회/수정 API 연동 |

#### 작업 2.2: AI 채팅 기능 (Home.jsx)
- [ ] 채팅방 존재 여부 확인 (`GET /api/eume-chats/me`)
- [ ] 채팅방 생성 (`POST /api/eume-chats`)
- [ ] 대화 내용 조회 (`GET /api/eume-chats/{id}/contents`)
- [ ] 메시지 발송 및 AI 응답 수신 (`POST /api/eume-chats/{id}/contents`)

### 4.3 Phase 3: 관리자 앱 연동 (우선순위: 중간)

#### 작업 3.1: 인증 시스템
| 페이지 | 연동 작업 |
|--------|----------|
| Login.jsx | 로그인 API 경로 수정, 소속기관 목록 연동 |
| (신규) Register.jsx | 회원가입 API 연동 |

#### 작업 3.2: 사용자 관리 (Users.jsx)
- [ ] 사용자 목록 조회 (페이지네이션, 필터링)
- [ ] 사용자 상세 조회
- [ ] 사용자 상태 변경
- [ ] Excel 내보내기

#### 작업 3.3: 감정 모니터링 (EmotionMonitor.jsx)
- [ ] 사용자별 감정 기록 조회
- [ ] 날짜 범위 필터링

#### 작업 3.4: 보고서 (Reports.jsx)
- [ ] 보고서 요약 조회
- [ ] Excel 다운로드

#### 작업 3.5: 대시보드 (Dashboard.jsx)
- [ ] 통계 데이터 연동

### 4.4 Phase 4: 공통 기능 개선 (우선순위: 낮음)

- [ ] API 서비스 레이어 생성 (`src/shared/api/services/`)
- [ ] React Query 또는 SWR 도입 검토
- [ ] 에러 바운더리 및 로딩 상태 통일

---

## 5. 데이터 타입 정의

### 5.1 사용자 관련

#### EumeUserProfileResponse
```typescript
interface EumeUserProfileResponse {
  email: string;
  userName: string;
  nickname: string;
  profileImage: string;
  sigungu: {
    sido: string;
    sigungu: string;
  };
  birthDate: string; // date format
  gender: string;
  phone: string;
  lastLoginDate: string; // datetime
  backGroundTheme: 'DEFAULT' | 'DARK' | 'LIGHT';
  createdAt: string;
  updatedAt: string;
}
```

#### EumeUserUpdateRequest
```typescript
interface EumeUserUpdateRequest {
  userName?: string;
  nickName?: string;
  profileImage?: string;
  sigunguId?: number;
  birthDate?: string;
  gender?: string;
  phone?: string;
  backgroundTheme?: 'DEFAULT' | 'DARK' | 'LIGHT';
}
```

### 5.2 채팅 관련

#### EumeChatContentCreateRequest
```typescript
interface EumeChatContentCreateRequest {
  messageContent: string; // required
}
```

#### EumeChatContentCreateResponse
```typescript
interface EumeChatContentCreateResponse {
  userMessage: {
    id: number;
    messageType: string;
    messageContent: string;
    createdAt: string;
  };
  eumeMessage: {
    id: number;
    messageType: string;
    messageContent: string;
    createdAt: string;
  };
}
```

### 5.3 관리자 관련

#### AdminLoginRequest
```typescript
interface AdminLoginRequest {
  sigunguId: number; // required
  adminLoginId: string; // required
  adminPw: string; // required
}
```

#### AdminLoginResponse
```typescript
interface AdminLoginResponse {
  id: number;
  adminName: string;
  adminEmail: string;
  lastLoginDate: string;
}
```

---

## 6. 인증 처리 방식

### 6.1 JWT 토큰 관리
- **저장 위치**: 쿠키 (`sh_access_token`) - HttpOnly 권장
- **요청 시**: `credentials: 'include'` 또는 `Authorization: Bearer ${token}`
- **만료 처리**: 401 응답 시 로그인 페이지로 리다이렉트

### 6.2 사용자 vs 관리자 구분
| 구분 | 토큰 키 | 세션 키 |
|------|---------|---------|
| 사용자 | `eume_user_token` | `user`, `oauth_user` |
| 관리자 | `token` | `eume_admin_user`, `eume_admin_session_expiry` |

---

## 7. 작업 우선순위 정리

### 즉시 수행 (1주차)
1. ~~API config.js 경로 수정~~ → **Phase 1**
2. 관리자 로그인 소속기관 목록 연동
3. 사용자 Home 페이지 AI 채팅 연동

### 단기 (2주차)
4. 사용자 Settings 프로필 조회/수정
5. 관리자 Users 페이지 목록/상세
6. 관리자 Dashboard 통계 연동

### 중기 (3주차)
7. 관리자 EmotionMonitor 연동
8. 관리자 Reports 연동
9. Excel 내보내기 기능

---

## 8. 참고 사항

### 8.1 CORS 설정
백엔드에서 프론트엔드 도메인 허용 필요:
```
Access-Control-Allow-Origin: http://localhost:3000
Access-Control-Allow-Credentials: true
```

### 8.2 환경 변수
```env
VITE_API_URL=http://localhost:8080/
```

### 8.3 Swagger 문서 위치
- UI: http://localhost:8080/swagger-ui/index.html
- JSON: http://localhost:8080/v3/api-docs

---

## 변경 이력

| 날짜 | 버전 | 작성자 | 내용 |
|------|------|--------|------|
| 2025-11-28 | 1.0 | Claude | 최초 작성 |
